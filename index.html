<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hex Fantastic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Rayer&apos;s personal code logs">
<meta property="og:type" content="website">
<meta property="og:title" content="Hex Fantastic">
<meta property="og:url" content="https://rayer.github.com/index.html">
<meta property="og:site_name" content="Hex Fantastic">
<meta property="og:description" content="Rayer&apos;s personal code logs">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hex Fantastic">
<meta name="twitter:description" content="Rayer&apos;s personal code logs">
  
    <link rel="alternate" href="/atom.xml" title="Hex Fantastic" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hex Fantastic</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">這世界有點無聊，找點架吵吧!</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://rayer.github.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-在CMake裡面使用Google-Test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/31/在CMake裡面使用Google-Test/" class="article-date">
  <time datetime="2017-05-31T14:57:22.000Z" itemprop="datePublished">2017-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/31/在CMake裡面使用Google-Test/">在CMake裡面使用Google Test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前想在CMake專案裡面使用，似乎很少有人提到如何把Google Test跟CMake很好的整合起來，所以寫了一篇簡單的心得來做個紀錄。</p>
<h2 id="首先取得Google-Test"><a href="#首先取得Google-Test" class="headerlink" title="首先取得Google Test"></a>首先取得Google Test</h2><p>我個人的習慣是把目錄分成這幾個目錄，我拿我現在正在寫的一個小專案來做例子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── CMakeLists.txt</div><div class="line">├── README.md</div><div class="line">├── deps</div><div class="line">│   └── googletest</div><div class="line">├── main.cpp</div><div class="line">├── src</div><div class="line">│   └── IHost.h</div><div class="line">└── <span class="built_in">test</span></div><div class="line">    └── twitter_basic.cpp</div></pre></td></tr></table></figure>
<p>其中deps專門用來放3rd party dependency。我個人是不太建議使用<strong>系統安裝</strong>來裝這種那麼小的東西，而且這會造成別人使用這個project的麻煩。</p>
<p>我自己是習慣使用<code>git submodule</code>來裝這種git專案就能拿到的東西，所以取得方法會像是這樣 : </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">➜  Octo git:(master) ✗ <span class="built_in">cd</span> dep</div><div class="line">➜  dep git:(master) ✗ git submodule add git@github.com:google/googletest.git</div><div class="line">Cloning into <span class="string">'/Users/rayer/Develop/Octo/dep/googletest'</span>...</div><div class="line">remote: Counting objects: 7670, done.</div><div class="line">remote: Compressing objects: 100% (12/12), done.</div><div class="line">remote: Total 7670 (delta 3), reused 7 (delta 2), pack-reused 7654</div><div class="line">Receiving objects: 100% (7670/7670), 2.61 MiB | 356.00 KiB/s, done.</div><div class="line">Resolving deltas: 100% (5686/5686), done.</div></pre></td></tr></table></figure>
<p>這樣deps底下就會有googletest這個子目錄了。其他人clone你的專案的時候，記得在<code>README.md</code>提醒一下對方要先<code>git submodule init</code>來取得所有的submodule。</p>
<p>當然取得google test的source code方法不只一種，你可以直接在deps裡面下<code>git clone</code>，或者直接download source code硬解到底下，結果應該差不多。</p>
<h2 id="CMake裡面的設定"><a href="#CMake裡面的設定" class="headerlink" title="CMake裡面的設定"></a>CMake裡面的設定</h2><p>Google Test完整支援CMake，所以整個構造會很簡單。其中下面的test/twitter_basic.cpp就是你寫你<code>TEST</code> <code>TEST_F</code> <code>TEST_P</code>的位置，請自己建立一個檔案。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 可加可不加，在這個範例不影響</span></div><div class="line"><span class="keyword">enable_testing</span>()</div><div class="line"></div><div class="line"><span class="comment"># 把google test整個cmake managed dir全部加進來</span></div><div class="line"><span class="keyword">add_subdirectory</span>(deps/googletest)</div><div class="line"></div><div class="line"><span class="comment"># 宣告include目錄有google test，通常順便連googlemock一起加入</span></div><div class="line"><span class="keyword">include_directories</span>(deps/googletest/googletest/<span class="keyword">include</span>)</div><div class="line"><span class="keyword">include_directories</span>(deps/googletest/googlemock/<span class="keyword">include</span>)</div><div class="line"></div><div class="line"><span class="comment"># 測試的主體。main宣告google test已經幫你宣告好了，直接用就是，就是gtest_main.cc</span></div><div class="line"><span class="keyword">add_executable</span>(twitter_test deps/googletest/googletest/src/gtest_main.cc test/twitter_basic.cpp)</div><div class="line"><span class="comment"># Link gtest library</span></div><div class="line"><span class="keyword">target_link_libraries</span>(twitter_test gtest)</div></pre></td></tr></table></figure>
<p>這樣基本上就能跑了，看起來會像這樣：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Running main() from gtest_main.cc</div><div class="line">[==========] Running 1 <span class="built_in">test</span> from 1 <span class="built_in">test</span> case.</div><div class="line">[----------] Global <span class="built_in">test</span> environment <span class="built_in">set</span>-up.</div><div class="line">[----------] 1 <span class="built_in">test</span> from SANITY</div><div class="line">[ RUN      ] SANITY.sanity</div><div class="line">[       OK ] SANITY.sanity (0 ms)</div><div class="line">[----------] 1 <span class="built_in">test</span> from SANITY (0 ms total)</div><div class="line"></div><div class="line">[----------] Global <span class="built_in">test</span> environment tear-down</div><div class="line">[==========] 1 <span class="built_in">test</span> from 1 <span class="built_in">test</span> <span class="keyword">case</span> ran. (0 ms total)</div><div class="line">[  PASSED  ] 1 test.</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2017/05/31/在CMake裡面使用Google-Test/" data-id="cj3d49luz000xj3sicw8k71xr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-most-vexing-parsingc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/03/most-vexing-parsingc/" class="article-date">
  <time datetime="2016-02-02T19:39:00.000Z" itemprop="datePublished">2016-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/03/most-vexing-parsingc/">Most Vexing Parsing(C++)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我在寫Daemonizer(註一)的時候，碰到了一個很奇怪的語法錯誤</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ifstream f(this-&gt;pid_file_name());</div><div class="line">string content(istreambuf_iterator&lt;char&gt;(f), istreambuf_iterator&lt;char&gt;());</div><div class="line">pid_t pid = stoi(content);</div></pre></td></tr></table></figure>
<p>他會跑出error，聲稱content是一個function所以無法當做stoi的引數。然而，要是這種傳法就能work </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">content</span><span class="params">(<span class="string">"123"</span>)</span></span>;</div><div class="line"><span class="comment">// OR</span></div><div class="line"><span class="built_in">string</span> content = <span class="built_in">string</span>(istreambuf_iterator&lt;<span class="keyword">char</span>&gt;(f), istreambuf_iterator&lt;<span class="keyword">char</span>&gt;());</div></pre></td></tr></table></figure>
<p>這錯誤的主要成因是，第一個例子中的<code>string content(istreambuf_iterator&lt;char&gt;(f), istreambuf_iterator&lt;char&gt;());</code>被錯誤的當成了function prototype（話說，哪個use case會要在函數本體內宣告另外一個函數的prototype?）。這種情況叫做<a href="https://en.wikipedia.org/wiki/Most_vexing_parse" target="_blank" rel="external">Most vexing parse</a></p>
<p>C++11提供了一個<a href="https://mbevin.wordpress.com/2012/11/16/uniform-initialization" target="_blank" rel="external">統一初始化方法</a>，也就是說，你用一個大括號把它包起來，他就一定會被認為是個物件初始化，而不是一個function prototype。C++11以前的話，只能再多一組括號把它包起來。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//C++11</div><div class="line">string content&#123;istreambuf_iterator&lt;char&gt;(f), istreambuf_iterator&lt;char&gt;()&#125;;</div><div class="line">//C++11以前的方法</div><div class="line">string content( (istreambuf_iterator&lt;char&gt;(f), istreambuf_iterator&lt;char&gt;()) );</div></pre></td></tr></table></figure>
<p>真是個討人厭的慣例啊（抓頭）….</p>
<p>(註一) 一個類似daemon的linux application，但是他是code層級，你只要繼承他，他就會幫你搞定所有Daemonize的事情</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2016/02/03/most-vexing-parsingc/" data-id="cj3d49luw000wj3sig3y04q9y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-text-color-support" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/23/markdown-text-color-support/" class="article-date">
  <time datetime="2015-08-23T03:22:00.000Z" itemprop="datePublished">2015-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/23/markdown-text-color-support/">Markdown文字色彩支援</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Markdown一個最麻煩的地方就是缺乏文字色彩的原生支援。之前查了網頁，10個裡面有8個說沒有，兩個說用css。但是後來我想起來Markdown本身就有原生支援html語法，那就簡單了…</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">我們要把<span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>文字<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"blue"</span>&gt;</span>變成<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"green"</span>&gt;</span>彩色<span class="tag">&lt;/<span class="name">font</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我們要把<font color="red">文字</font><font color="blue">變成</font><font color="green">彩色</font></p>
<p>恩，其實滿直覺的，怎麼一開始沒想到這招囧…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2015/08/23/markdown-text-color-support/" data-id="cj3d49lv1000yj3si7hnm36o3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sourceforge-bundled-third-party-software-causes-serious-disputes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/15/sourceforge-bundled-third-party-software-causes-serious-disputes/" class="article-date">
  <time datetime="2015-06-14T21:05:00.000Z" itemprop="datePublished">2015-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/15/sourceforge-bundled-third-party-software-causes-serious-disputes/">SourceForge綑綁第三方軟體引發嚴重爭議</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在幾天以前，<a href="http://sf.net" target="_blank" rel="external">SourceForge</a>啟動了一項頗具爭議性的政策 : 他們擅自「接管」了一些他們認為「被遺棄」的，本來在SourceForge host的軟體，重新包裝了installer並且植入了第三方軟體，比方說惡名昭彰的MacKeeper等等。</p>
<p>在GitHub崛起以前，SourceForge一直是大多數開源軟體首選的host地點，就好像我們的OpenFoundary一樣。然而在GitHub等等免費託管服務越來越盛行的同時，SourceForge也有越來越多的使用者改用GitHub，而SourceForge上面的軟體就比較沒有在更新了。</p>
<p>在幾天前，SourceForge擅自對「被認定遺棄」的軟體做了一些調整，他們重新包裝了這些專案的installer，暗地在裡面放入了臃腫或者廣告軟體。最早發現這事情的專案擁有者是Gimp for Windows，這引發了開源社群的全面…暴怒(該用這個形容詞嗎)，比分說NotePad++作者就憤怒地把專案完全從SourceFor遷出去。</p>
<blockquote>
<p>Obviously, the paid component per installation system is one of their important income generating scams. I would be fine with that, if they were the actual owners of the legitimate software. The real problem is, they are polluting these open source software installations for the purpose of filling their pockets by this scam, and worst of all, without even notifying the authors/creators of this software, while the creators are struggling against such parasitic software in order to keep their installers cleaner and safer.</p>
</blockquote>
<p>顯然這些付費嵌入的程式，是他們一個很重要的收入 - 以及詐騙的來源。老實講，如果嵌入者是這些專案的擁有者，我還不會那麼在意。真正的問題是，他們正在污染整個open source的軟體，靠這些根本是詐欺的手段去填滿他們的錢包，而且更糟糕的是，甚至連致力於對抗以及清除問題軟體，讓專案installer更安全的專案擁有者都不通知一聲。</p>
<blockquote>
<p>Such a shameless policy should be condemned, and the Notepad++ project will move entirely out of SourceForge.</p>
</blockquote>
<p>這種無恥的行徑應該要被強烈譴責，我宣布Notepad++將完全移出SourceForge。</p>
<p>其實SourceForge做這種事也不是第一天了，以前他們會在某些Windows Installer在有知會開發者的前提下綑綁軟體。不過，明目張膽的「接管」他們認定「被遺棄」的軟體來玩這套，倒是真正的引發了眾怒。</p>
<p>SourceForge知道了這事情的嚴重性，在6/3宣告停止這種行為(除非開發者允許)。不過看起來這次SourceForge對開發者來講，損失的信心恐怕很難再回來了。</p>
<p>延伸閱讀：<a href="http://arstechnica.com/information-technology/2015/06/black-mirror-sourceforge-has-now-siezed-nmap-audit-tool-project/" target="_blank" rel="external">他連NMAP都敢動耶!</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2015/06/15/sourceforge-bundled-third-party-software-causes-serious-disputes/" data-id="cj3d49luv000vj3sinli1in5j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-oauth-with-android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/12/oauth-with-android/" class="article-date">
  <time datetime="2015-04-12T04:40:00.000Z" itemprop="datePublished">2015-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/12/oauth-with-android/">舊文回收:OAuth with Android</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>這篇是我兩三年前寫在Levitation的blogspot，由於排版很爛，所以回收到這裏重新用Markdown寫一次</p>
<p>###淺談OAuth in Android – 以Plurk為例子<br>OAuth是目前比較熱門的認證機制之一，他有個最大的好處就在於完全不需要在client端輸入賬號密碼，這部分完全會由web端完成。不過，他機制非常的複雜，有些地方做的讓人覺得很龜毛，所以我們在這篇只要淺談就好，其他的部分我會介紹一個函式庫來把它完成。</p>
<p>這邊有一篇非常不錯的<a href="http://cire.pixnet.net/blog/post/30810748-漫談oauth認證協定與運作流程" target="_blank" rel="external">OAuth機制介紹</a>，有興趣的朋友可以看看。太細節部分的工作原理我們就不涉足了，我們專心看看最基本的認證步驟</p>
<ol>
<li>app開發者跟網站註冊取得API Key跟API Secret</li>
<li>開始認證的時候，用這組key/secret/callback(<em>1)跟網站要一個Request Token(</em>2)</li>
<li>用這組Request Token, callback組合成一個網址，讓使用者進入該網址認證。</li>
<li>認證成功以後會傳回一個oauth_verifier，通常是一個很好閱讀的字串或者數字</li>
<li>app端把這組verifier，以及request key跟網站取得半永久性的Access Token(*2)</li>
<li>往後對這個網站任何要求（比方說，plurk來講，取得時間軸）使用這個Token即可，app把它存起來備用，就不需要重新跟網站申請認證了。</li>
</ol>
<p>這幾個步驟其實相當的繁瑣，尤其是對網站要求每次都要做一個全面性的Parameter Sign的動作，裡面牽涉的東西對一個初學者來講真是煩人到爆炸。當然，就會有人會寫一組library來解決這問題:我們今天介紹的就是oauth-signpost library。</p>
<p>基本的取得jar，放進project，設定buildpath這些基礎到爆的東西我們就不討論了。首先，我們要先去Plurk申請一組API Key來作為我們的開發用途。所以我們就有了API Key/Secret了。接下來，回到Plurk API介紹的頁面，他提供了幾個網址供OAuth使用。基本上這些分別是幹嘛的我們就不予深究了，我們只要知道她是要怎麼用。</p>
<p>signpost我們會用到根OAuth有關的一共有兩個部分：OAuthConsumer代表的是我們APP端的所有資料，包含Access Token等等（不過她好像沒幫你存，你要自己存），而OAuthProvider則是代表網站的OAuth認證部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_REQUEST_URL = <span class="string">"http://www.plurk.com/OAuth/request_token"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_AUTHORIZATION_URL = <span class="string">"http://www.plurk.com/m/authorize"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_ACCESS_URL = <span class="string">"http://www.plurk.com/OAuth/access_token"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_CALLBACK_URL = <span class="string">"myplurk:///"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_CONSUMER_KEY = <span class="string">"你的API Key"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String PLURK_CONSUMER_SECRET = <span class="string">"你的API Secret"</span>;</div></pre></td></tr></table></figure>
<p>我們先把這些東西設定變數，等等會用到。接下來我們設定Provider跟Consumer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mainConsumer = <span class="keyword">new</span> DefaultOAuthConsumer(PLURK_CONSUMER_KEY, PLURK_CONSUMER_SECRET);</div><div class="line">mainProvider = <span class="keyword">new</span> DefaultOAuthProvider(PLURK_REQUEST_URL, PLURK_ACCESS_URL, PLURK_AUTHORIZATION_URL);</div></pre></td></tr></table></figure>
<p>ok，那所有東西差不多就完成了。我們要讓使用者認證的時候，只要開一個url，載入provider提供的url :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String url = mainProvider.retrieveRequestToken(mainConsumer, PLURK_CALLBACK_URL);</div></pre></td></tr></table></figure>
<p>利用webview打開這個以後，把webview設定一個WebViewClient，然後override它的link click</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthClient</span> <span class="keyword">extends</span> <span class="title">WebViewClient</span> </span>&#123;</div><div class="line"> </div><div class="line"> </div><div class="line">  <span class="meta">@Override</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">  <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line"> &#125;</div><div class="line">  <span class="meta">@Override</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">  <span class="keyword">super</span>.onPageFinished(view, url);</div><div class="line"> &#125;</div><div class="line">  <span class="meta">@Override</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String urlString)</span> </span>&#123;</div><div class="line"> </div><div class="line"> Log.d(<span class="string">"SubPlurkV2"</span>, <span class="string">"url : "</span> + urlString);</div><div class="line"> <span class="keyword">if</span>(urlString.contains(<span class="string">"subplurkv2"</span>)) &#123;</div><div class="line"> Uri url = Uri.parse(urlString);</div><div class="line"> String verifier = url.getQueryParameter(<span class="string">"oauth_verifier"</span>);</div><div class="line"> <span class="keyword">try</span> &#123;</div><div class="line"> SystemManager.getInst().getAuthManager().aquireAccessToken(verifier);</div><div class="line"> &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line"> <span class="comment">// TODO Auto-generated catch block</span></div><div class="line"> e.printStackTrace();</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> finish();</div><div class="line"> &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, urlString);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>然後我們可以取得verifier，利用這個取得Access Token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mainProvider.retrieveAccessToken(mainConsumer, verifier);</div><div class="line">Log.d(<span class="string">"SubPlurkV2"</span>, <span class="string">"Token = "</span> + mainConsumer.getToken() + <span class="string">" and secret = "</span> + mainConsumer.getTokenSecret());</div></pre></td></tr></table></figure>
<p>把這祖Token記錄起來，以後會用到。最後，我們來試試看最簡單地拿取時間軸吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mainConsumer.setAccessToken(<span class="string">"U5GNYyH6wVGS"</span>, <span class="string">"aCtJ9XVgNTeIpigq3qxsLi70Sv0HbA6h"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">URL url = <span class="keyword">new</span> URL(<span class="string">"http://www.plurk.com/APP/Timeline/getPlurks"</span>);</div><div class="line">HttpURLConnection request = (HttpURLConnection) url.openConnection();</div><div class="line">request.setDoOutput(<span class="keyword">true</span>);</div><div class="line">request.setRequestMethod(<span class="string">"POST"</span>);</div><div class="line">mainConsumer.sign(request);</div><div class="line">request.connect();</div><div class="line">String context = StreamUtil.InputStreamToString(request.getInputStream());</div><div class="line">Log.d(<span class="string">"SubPlurkV2"</span>, <span class="string">""</span> + context);</div></pre></td></tr></table></figure>
<p>have fun! 參考plunk api list繼續實做其他的api吧!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2015/04/12/oauth-with-android/" data-id="cj3d49luu000uj3sil3oo1t15" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-redmine-settings" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/redmine-settings/" class="article-date">
  <time datetime="2015-03-30T12:13:00.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/redmine-settings/">Redmine設定(Digital Ocean, Docker)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>花了一點時間搞定了Redmine，眉眉角角還挺多的。</p>
<p>首先我省麻煩，直接從Digital Ocean租一個最便宜的5USD/mo的instance應該是夠的(Digital Ocean的Redmine image似乎有最佳化過，我在Linode的1G instance都build不起來，但是在DO不用Build，直接在0.5G可以裝起來的)<br><img src="http://user-image.logdown.io/user/2167/blog/2169/post/258922/Ugiaden4Qiy80YGdlJ31_Screen%20Shot%202015-03-31%20at%204.15.18%20AM.png" alt="Screen Shot 2015-03-31 at 4.15.18 AM.png"></p>
<p>選他的Redmine image，其實熟手的話直接用Docker裝也是可以的。<br><img src="http://user-image.logdown.io/user/2167/blog/2169/post/258922/4gYyX1QPq3aJsqWlWtDA_Screen%20Shot%202015-03-31%20at%204.18.43%20AM.png" alt="Screen Shot 2015-03-31 at 4.18.43 AM.png"></p>
<p>接下來大家都很熟，DO會寄信給你告訴你Root帳號密碼。Login以後還會多一行字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-------------------------------------------------------------------------------------</div><div class="line">These instructions are stored in /root/REDMINE for your review.</div><div class="line">-------------------------------------------------------------------------------------</div><div class="line">To finish installing Redmine, navigate to your droplet&apos;s IP: http://123.456.22.11 and use credentials from below.</div><div class="line">-------------------------------------------------------------------------------------</div><div class="line">User: admin</div><div class="line">Pass: CIdAcEEkcC(當然這是改過的)</div><div class="line">-------------------------------------------------------------------------------------</div><div class="line">Make sure to specify hostname from DO panel to your droplet before creating it (for example: &apos;project.mydomain.com&apos; or &apos;myproject.com&apos;)</div><div class="line">This will create the necessary Nginx configs based on hostname and Nginx will respond based on hostname.</div><div class="line">-------------------------------------------------------------------------------------</div></pre></td></tr></table></figure>
<p>基本上已Redmine來講這樣就好了。但是如果我們自己有DNS用CNAME連過去的話會發現，他永遠處於「沒裝好」的狀態。這時候就得改<code>/etc/nginx/sites-enabled/redmine</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;</div><div class="line">        server_name 104.236.144.91 redmine.rayer.idv.tw;</div><div class="line"></div><div class="line">        root /srv/redmine/public;</div><div class="line">        passenger_enabled on;</div><div class="line"></div><div class="line">        client_max_body_size 10m;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>server_name要放入正確的CNAME，這樣redmine才能夠正確的讀取到。</p>
<p>接下來就是安裝git。先在本機端把git裝起來<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure></p>
<p>然後要去redmine的設定檔裡面更新git路徑。我們可以從上面的redmine nginx設定檔看到，他root在<code>/srv/redmine/public</code>，不過我們要去他的設定目錄<code>/srv/redmine/config/</code>改他的configuration.yml。不過，沒這檔案…請<code>cp configuration.yml.example configuration.yml</code>，幫他把git路徑補起來<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scm_git_command:	/usr/bin/git</div></pre></td></tr></table></figure></p>
<p>最後重開nginx，收工。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service nginx restart</div></pre></td></tr></table></figure></p>
<p>基本上用Docker就更簡單了，我本來還在想要不要包一個docker image來用，不過網路上已經有人包好了 (<a href="https://github.com/sameersbn/docker-redmine" target="_blank" rel="external">https://github.com/sameersbn/docker-redmine</a> )</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2015/03/30/redmine-settings/" data-id="cj3d49lus000tj3si0s9kne2v" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-for-some-stupid-memories" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/12/02/for-some-stupid-memories/" class="article-date">
  <time datetime="2014-12-02T08:07:00.000Z" itemprop="datePublished">2014-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/02/for-some-stupid-memories/">一段白爛往事</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天看到有人在討論版上討論，關於一個雙層for迴圈該怎麼最佳化的問題。我每次看到這個問題都會想到這個往事….</p>
<p>「誒某R，我把某段Code最佳化了，我把時間複雜度從O(n^2)降成O(n)」<br>「喔喔，這還真是滿大的突破，那段還滿吃緊的呢。你是怎麼做到的？」<br>「簡單啊，看我的code」</p>
<p>before :</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i)</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++i) &#123;</div><div class="line">  	process(target[i][j]);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>after :</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; ++i) &#123;</div><div class="line"> 	process(*((target*)(&amp;target) + i));</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>我整個下午都在一直在想，我應該要尻他腦袋尻多少下才能讓他醒過來，然後下班時間就到了。</p>
<p>我把這個「最佳化」寫成一個範例給大家參考一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"value = "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">const</span> <span class="keyword">int</span> row = <span class="number">5</span>;</div><div class="line">	<span class="keyword">const</span> <span class="keyword">int</span> col = <span class="number">6</span>;</div><div class="line">	<span class="keyword">int</span> var[row][col];</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="comment">//for initialization propose, not part of demo</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; row; ++i)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; col; ++j)</div><div class="line">			var[i][j] = value++;</div><div class="line">			</div><div class="line">	<span class="comment">//這就是他說的before</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; row; ++i)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; col; ++j)</div><div class="line">			process(var[i][j]);</div><div class="line">      </div><div class="line">	<span class="comment">//這就是他說的 效能增進一個數量級的after</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row * col; ++i) &#123;</div><div class="line">		process(*((<span class="keyword">int</span>*)(&amp;var) + i));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2014/12/02/for-some-stupid-memories/" data-id="cj3d49lur000sj3si3ux90bf9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-coder-said-coder-wants" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/26/coder-said-coder-wants/" class="article-date">
  <time datetime="2014-06-26T07:14:00.000Z" itemprop="datePublished">2014-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/26/coder-said-coder-wants/">Coder說的跟Coder所想的</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th style="text-align:left">我說的</th>
<th style="text-align:left">我想的</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">這code這樣做很髒</td>
<td style="text-align:left">這段code髒透了，不過不是我寫的</td>
</tr>
<tr>
<td style="text-align:left">這code只是暫時性先這樣做</td>
<td style="text-align:left">我寫的這段code髒透了</td>
</tr>
<tr>
<td style="text-align:left">這段code壞掉了</td>
<td style="text-align:left">你寫的這段code有bug</td>
</tr>
<tr>
<td style="text-align:left">這段code還有一點點小問題</td>
<td style="text-align:left">我寫的這段code有bug</td>
</tr>
<tr>
<td style="text-align:left">這段code很晦澀難懂</td>
<td style="text-align:left">有人寫這段code居然連個註解都不加</td>
</tr>
<tr>
<td style="text-align:left">這段code自己就夠淺顯易懂</td>
<td style="text-align:left">我寫這段code沒有註解</td>
</tr>
<tr>
<td style="text-align:left">這是個很棒的語言</td>
<td style="text-align:left">這是我最喜歡的語言，而且他用起來很方便</td>
</tr>
<tr>
<td style="text-align:left">你要調整你對這語言的認知</td>
<td style="text-align:left">這是我最喜歡的語言，但是他很難用</td>
</tr>
<tr>
<td style="text-align:left">我看得懂這段Perl Code</td>
<td style="text-align:left">這段Perl Code是我寫的</td>
</tr>
<tr>
<td style="text-align:left">我看不懂這段Perl Code</td>
<td style="text-align:left">這段Perl Code不是我寫的</td>
</tr>
<tr>
<td style="text-align:left">這code結構很糟</td>
<td style="text-align:left">別人寫了一個很糟的結構</td>
</tr>
<tr>
<td style="text-align:left">這code結構複雜了點</td>
<td style="text-align:left">我寫了一個很糟的結構</td>
</tr>
<tr>
<td style="text-align:left">Bug</td>
<td style="text-align:left">這程式少了我想要的功能</td>
</tr>
<tr>
<td style="text-align:left">這是不在計劃內的功能</td>
<td style="text-align:left">這程式少了我不想要的功能</td>
</tr>
<tr>
<td style="text-align:left">漂亮的解法</td>
<td style="text-align:left">這做法OK，而且我看得懂</td>
</tr>
<tr>
<td style="text-align:left">我們需要重寫這一段</td>
<td style="text-align:left">這做法OK，但是我看不懂</td>
</tr>
<tr>
<td style="text-align:left">emacs比vi優秀</td>
<td style="text-align:left">這裡太和平了，我們找點架來吵吧!</td>
</tr>
<tr>
<td style="text-align:left">vi比emacs優秀</td>
<td style="text-align:left">這邊太和平了，我們找點架來吵吧!</td>
</tr>
<tr>
<td style="text-align:left">「恩…恕我直言…」</td>
<td style="text-align:left">我想很婉轉地說，你他媽的錯了</td>
</tr>
<tr>
<td style="text-align:left">「舊code」</td>
<td style="text-align:left">這段code能運作，但沒人知道為什麼</td>
</tr>
<tr>
<td style="text-align:left">^X^Cquit^[ESC][ESC}^C</td>
<td style="text-align:left">救命，我不知道怎麼退出vi!</td>
</tr>
</tbody>
</table>
<p><img src="https://lh5.googleusercontent.com/-ZEl2v3vcu_8/U4qv-3Jf16I/AAAAAAAA5gE/lE3NqEBj9IY/w506-h633/2014%2B-%2B1" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2014/06/26/coder-said-coder-wants/" data-id="cj3d49luq000rj3silckkrjgp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-why-are-threadstop-of-java-should-not-be-used" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/09/why-are-threadstop-of-java-should-not-be-used/" class="article-date">
  <time datetime="2014-06-09T04:27:00.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/why-are-threadstop-of-java-should-not-be-used/">[翻譯] 為什麼Java的Thread.stop()不該被使用？</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>這篇算是相當詳盡的說明了一些設計原則，包含了為什麼Java不再允許使用者直接中止(kill)掉一個運行中的thread物件，以及有沒有任何的替代方案。相對的，C++的std::thread也有一些行為上需要注意的地方，不過往後再提這點。</p>
<p><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html" target="_blank" rel="external">原文在此</a></p>
<h2 id="Java-Thread為什麼有些method被廢棄了"><a href="#Java-Thread為什麼有些method被廢棄了" class="headerlink" title="Java Thread為什麼有些method被廢棄了"></a>Java Thread為什麼有些method被廢棄了</h2><h3 id="為什麼Thread-stop不再被支援了？"><a href="#為什麼Thread-stop不再被支援了？" class="headerlink" title="為什麼Thread.stop不再被支援了？"></a>為什麼Thread.stop不再被支援了？</h3><p>理由很簡單：這東西從本質上就不安全。你去.stop()一個thread會造成所有該thread同步資源鎖定(lock)的區段全部都解鎖(unlock)。只要系統抓到ThreadDeath這個exception，該區段的同步鎖定都會被unlock。<br>Because it is inherently unsafe. Stopping a thread causes it to unlock all the monitors that it has locked. (The monitors are unlocked as the ThreadDeath exception propagates up the stack.) If any of the objects previously protected by these monitors were in an inconsistent state, other threads may now view these objects in an inconsistent state. Such objects are said to be damaged. When threads operate on damaged objects, arbitrary behavior can result. This behavior may be subtle and difficult to detect, or it may be pronounced. Unlike other unchecked exceptions, ThreadDeath kills threads silently; thus, the user has no warning that his program may be corrupted. The corruption can manifest itself at any time after the actual damage occurs, even hours or days in the future.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2014/06/09/why-are-threadstop-of-java-should-not-be-used/" data-id="cj3d49luo000qj3si964l4ddr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-what-function-whats-to-hint-you" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/08/what-function-whats-to-hint-you/" class="article-date">
  <time datetime="2014-06-07T22:53:00.000Z" itemprop="datePublished">2014-06-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/08/what-function-whats-to-hint-you/">C++傳回值想要「暗示」你什麼?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有時候很多class function, global function傳達了一些所謂的「絃外之音」，而這些「絃外之音」有時候稱為「慣例」，不過更多的時候會被默默地忽略掉。拜自動型別判斷所賜，先不考慮複雜的template情況下，這些code是可能額外的要告訴些你什麼？或者說，根本是錯誤的傳回值？</p>
<p>以下先都不考慮C++11的<code>operator&amp;&amp;</code>以及<code>std::move</code>，但是我們會用到C++11的新關鍵字<code>auto</code>。我們先假設以下四個都是某個class foo的成員函數</p>
<pre><code>const std::string&amp; getValue();
const std::string getValue();
std::string&amp; getValue();
std::string getValue();
</code></pre><p>這四個東西我們一個個來看吧</p>
<ul>
<li><code>const std::string&amp; getValue();</code><ul>
<li>他很明顯的是告訴你它會回傳一個不可修改的值，這種傳回值通常代表著兩種意義，要不是這個值並不容許被改，要不就是他會有一個額外的setter來給你改這個值。</li>
</ul>
</li>
<li><code>const std::string getValue();</code><ul>
<li>這是比較奇怪的設計，他傳回一個複製過的const副本給外界，在大多數情況下這是一種不太合理的做法。我多半在一些有嚴重const hazard(const設計不良以至於很多參數都無法用預期的const/non-const運作)看過這種code</li>
</ul>
</li>
<li><code>std::string&amp; getValue();</code><ul>
<li>這種則是典型的命名錯誤，這東西其實不太應該叫做getValue，應該要叫做getValueRef比較不會讓人搞混，但是很多人其實就是這樣寫下去了。他給的暗示是：這是一個可以更改的數值，我沒有setter，以及最重要的暗示：「這東西的修改很可能不會立即生效，要等到下一個fetching命令執行才會生效」。因為很顯然的，除非在極少數的情況下特地去override operator&amp;(而且這是100%的危險行為，應該不會有人這樣做)，否則這個class foo應該是沒有什麼機會能夠得知這個value被改了。<ul>
<li>這也是俗稱的串燒函數，不過多半是用在modifier而非getter。這種串燒可以達到典型的<code>split(&#39;.&#39;).append(&quot;Ass&quot;).erase(2, std::string::npos);</code>這種效果。</li>
</ul>
</li>
</ul>
</li>
<li><code>std::string getValue();</code><ul>
<li>這個很傳統，超傳統，就是很普通的by value取值，拿出去你要怎麼亂搞都行，怎麼搞都不會影響到class。串燒也能這樣寫，不過意義不同而且比較耗效能，正常來講應該是不太會有人拿這種東西去串燒的。</li>
</ul>
</li>
</ul>
<p>大多數的情況下，我們會提供1/4兩種getter。1很重要，他提供了以下這種能力</p>
<pre><code>void someFunction(const std::string&amp; a);
</code></pre><p>  …<br>  …<br>  …<br>  someFunction(foo-&gt;getValue());</p>
<p>在大多數的情況以及正確的設計下，當參數傳遞可以很大程度的省下deep-copy的成本，如果沒提供的話就會變成普通的copy by value(用於產生暫時性的不具名物件，浪費死了)。而4則可以當作是最普通的「可以安全的拿出來亂玩」的getter。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rayer.github.com/2014/06/08/what-function-whats-to-hint-you/" data-id="cj3d49lum000pj3si98p0dlj2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">六月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/31/在CMake裡面使用Google-Test/">在CMake裡面使用Google Test</a>
          </li>
        
          <li>
            <a href="/2016/02/03/most-vexing-parsingc/">Most Vexing Parsing(C++)</a>
          </li>
        
          <li>
            <a href="/2015/08/23/markdown-text-color-support/">Markdown文字色彩支援</a>
          </li>
        
          <li>
            <a href="/2015/06/15/sourceforge-bundled-third-party-software-causes-serious-disputes/">SourceForge綑綁第三方軟體引發嚴重爭議</a>
          </li>
        
          <li>
            <a href="/2015/04/12/oauth-with-android/">舊文回收:OAuth with Android</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Rayer<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>