<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-starting-java-console-application-with-maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/12/starting-java-console-application-with-maven/" class="article-date">
  <time datetime="2014-03-11T22:57:00.000Z" itemprop="datePublished">2014-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/12/starting-java-console-application-with-maven/">Starting Java Console Application with Maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/03/12/starting-java-console-application-with-maven/" data-id="cj3b76vos000ihzsis5eb0538" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-unordered-collections-in-c-11" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/02/unordered-collections-in-c-11/" class="article-date">
  <time datetime="2014-02-02T03:37:00.000Z" itemprop="datePublished">2014-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/02/02/unordered-collections-in-c-11/">unordered collections in C++11</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/02/02/unordered-collections-in-c-11/" data-id="cj3b76vor000hhzsiftnx4kvg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-constructor-call-another-constructor-w-c-11" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/01/constructor-call-another-constructor-w-c-11/" class="article-date">
  <time datetime="2014-01-31T17:12:00.000Z" itemprop="datePublished">2014-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/02/01/constructor-call-another-constructor-w-c-11/">Constructor call another Constructor w/ C++11</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>剛剛才意外發現的一個C++11 new feature, 參考一下。</p>
<p>很多情況下我們會希望能從一個constructor去call另外一個constructor，比方說<code>foo()</code>希望就可以直接比照<code>foo(0,0)</code>, 或者說<code>foo(2,6)</code>可以直接比照<code>foo(2,6,POLICY_DEFAULT)</code>。在函數層級來講這個很簡單<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">double foo() &#123;</div><div class="line">	return foo(0, 0);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但是如果foo是個constructor的話，基本上是做不到的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">foo::foo() &#123;</div><div class="line">	foo::foo(0, 0); //error!!!</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這個其實不止C++, Java也蠻常見這種需求的，只是一直沒有解法。在C++03/Java裡面，我們比較常見的做法只能大約做到類似這樣而已 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">foo::foo() &#123;</div><div class="line">	init(0, 0); //或者我們也可以用default parameter的方法，init(double a = 0, double b = 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo::foo(double a, double b) &#123;</div><div class="line">	init(a, b);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>利用init去繞過這條限制。不過在C++11以後，這條限制就被解除了，我們可以利用相當類似C++的initialization list的方式來解決這個問題</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">foo::foo() : foo(0, 0) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>皆大歡喜，ohya，不過java還是得用init()的方法來做 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/02/01/constructor-call-another-constructor-w-c-11/" data-id="cj3b76von000ghzsiqvetpfci" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-recycle-from-past-game-loop-update-in-c" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/23/recycle-from-past-game-loop-update-in-c/" class="article-date">
  <time datetime="2014-01-23T09:10:00.000Z" itemprop="datePublished">2014-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/23/recycle-from-past-game-loop-update-in-c/">(Recycle from past) Game loop update in C#</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Game loop in C#<br>Game update loop is a problem in C#. Of course, first thought of us must be attach the Idle event of Application, like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Application.Idle += new EventHandler(OnAppIdle);</div><div class="line">Application.Run(mMainFrame);</div><div class="line"></div><div class="line">static void OnAppIdle(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">	//Do some game loop update here</div><div class="line">	mMainFrame.DoUpdate();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>It seems reasonable, we register a listener to Idle event, so it must be run OnAppIdle while application idle, right?</p>
<p>Partially right.</p>
<p>When the application keep going, it will only get message while “When application need to be updated”. It means, therefore, if you leave mouse out of this application form(so no MouseMove event sent), it will totally stop, so it will be updated only when getting some message : such like OnMouseMove….etc.</p>
<p>Solution is from Rich, and he found it in sample of MDX applications. Don’t ask me how to do it, just need to know use this way to keep the game loop.</p>
<p>We might discuss this in later post =3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">static class Program</div><div class="line">&#123;</div><div class="line">///</div><div class="line">/// The main entry point for the application.</div><div class="line">///</div><div class="line">/// </div><div class="line">	static SceneEditorMain mMainFrame;</div><div class="line">	[STAThread]</div><div class="line">	static void Main()</div><div class="line">	&#123;</div><div class="line">		Application.EnableVisualStyles();</div><div class="line">		Application.SetCompatibleTextRenderingDefault(false);</div><div class="line">		mMainFrame = new SceneEditorMain();</div><div class="line">		Application.Idle += new EventHandler(OnAppIdle);</div><div class="line">		Application.Run(mMainFrame);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	static void OnAppIdle(object sender, EventArgs e)</div><div class="line">	&#123;</div><div class="line">		while (AppStillIdle)</div><div class="line">		&#123;</div><div class="line">			mMainFrame.DoUpdate();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	private static bool AppStillIdle</div><div class="line">	&#123;</div><div class="line">		get</div><div class="line">		&#123;</div><div class="line">			NativeMethods.Message msg;</div><div class="line">			return !NativeMethods.PeekMessage(out msg, IntPtr.Zero, 0, 0, 0);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">	public class NativeMethods</div><div class="line">	&#123;</div><div class="line">	/**/</div><div class="line">	///</div><div class="line">	Windows Message</div><div class="line"></div><div class="line">	[StructLayout(LayoutKind.Sequential)]</div><div class="line">	public struct Message</div><div class="line">	&#123;</div><div class="line">		public IntPtr hWnd;</div><div class="line">		public uint msg;</div><div class="line">		public IntPtr wParam;</div><div class="line">		public IntPtr lParam;</div><div class="line">		public uint time;</div><div class="line">		public System.Drawing.Point p;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	[System.Security.SuppressUnmanagedCodeSecurity]</div><div class="line">	[DllImport(&quot;User32.dll&quot;, CharSet = CharSet.Auto)]</div><div class="line">	public static extern bool PeekMessage(out Message msg, IntPtr hWnd, uint messageFilterMin, uint messageFilterMax, uint flags);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/23/recycle-from-past-game-loop-update-in-c/" data-id="cj3b76voj000fhzsihelk6e9l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-c-11-ways-to-obtain-high-accuracy-of-time" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/22/c-11-ways-to-obtain-high-accuracy-of-time/" class="article-date">
  <time datetime="2014-01-22T02:38:00.000Z" itemprop="datePublished">2014-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/22/c-11-ways-to-obtain-high-accuracy-of-time/">C++11 取得精確度很高的時間的方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在製作遊戲時，有一個函數相當重要，幾乎大多數realtime的遊戲都需要它（其實只要任何東西會動，可能都跟他脫不了干系），這個函數稱為<code>update(Ty delta);</code>。這個delta在java相當容易時間，就是拿<code>System.getTimeinMillis();</code>，不過在C++裡面這個卻變得有點困難 – 在C++11以前，幾乎都得靠平台相依的方法才能取得。Windows API的話就是<code>void QueryPerformanceCounter( LARGE_INTEGER* currentTime );</code>，linux下可能就只能用<code>clock_getTime</code>或者用time_fd硬幹，C++本身只有提供time(0)可以讓你拿到一個….精確度到秒（甚至還不太精確）的…顯然不太夠用的時間。</p>
<p>C++11以後，std提供了chrono library, 使得這終於有一個跨平台的解答。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">int main(int argc, const char * argv[])</div><div class="line">&#123;</div><div class="line">    typedef std::chrono::high_resolution_clock time;</div><div class="line">    typedef std::chrono::milliseconds ms;</div><div class="line">    </div><div class="line">    //initialize</div><div class="line">    auto timer = time::now();</div><div class="line">    </div><div class="line">    while(true) &#123;</div><div class="line">     </div><div class="line">        double delta = std::chrono::duration_cast&lt;std::chrono::duration&lt;double, std::ratio&lt;1&gt;&gt;&gt;(time::now() - timer).count();</div><div class="line"></div><div class="line"></div><div class="line">        std::cout &lt;&lt; delta &lt;&lt; std::endl;</div><div class="line">        timer = time::now();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/22/c-11-ways-to-obtain-high-accuracy-of-time/" data-id="cj3b76vog000dhzsim4px1bfg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-talking-about-the-c-11-lambda-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/20/talking-about-the-c-11-lambda-3/" class="article-date">
  <time datetime="2014-01-20T02:19:00.000Z" itemprop="datePublished">2014-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/20/talking-about-the-c-11-lambda-3/">淺談C++11 Lambda (3)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>不過Lambda也是有侷限的。</p>
<p>廢話少說，我們來複習一下世界上最低效最基礎的泡沫排序法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">void sort(std::vector&lt;int&gt;&amp; raw) &#123;</div><div class="line">	int n = raw.size();</div><div class="line">	int temp;</div><div class="line">	for (int i = n - 1; i &gt; 0; i--)</div><div class="line">	&#123;</div><div class="line">		for (int j = 0; j &lt;= i - 1; j++)</div><div class="line">		&#123;</div><div class="line">			if (raw[j] &gt; raw[j + 1])</div><div class="line">			&#123;</div><div class="line">				temp = raw[j];</div><div class="line">				raw[j] = raw[j + 1];</div><div class="line">				raw[j + 1] = temp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char *argv[]) &#123;</div><div class="line">	//requires C++11</div><div class="line">	std::vector&lt;int&gt; array = &#123;15, 22, 11, 13, 72, 19&#125;;</div><div class="line">	sort(array);</div><div class="line">	</div><div class="line">	for(int i : array)</div><div class="line">		std::cout &lt;&lt; i &lt;&lt; &quot; &quot;;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>這code能吐槽的地方很多，不過我們先不管 XD。這sort我們需要至少兩種加強：</p>
<ol>
<li>他要能接受所有型別</li>
<li>他要能自定比較子(comparer, 決定A B哪個大哪個小的邏輯)</li>
</ol>
<p>我們先假設所有人對於template都很熟了，第一個需求可以很簡單的用template完成 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">template&lt;typename T&gt;</div><div class="line">void sort(std::vector&lt;T&gt;&amp; raw) &#123;</div><div class="line">	int n = raw.size();</div><div class="line">	T temp;</div><div class="line">	for (int i = n - 1; i &gt; 0; i--)</div><div class="line">	&#123;</div><div class="line">		for (int j = 0; j &lt;= i - 1; j++)</div><div class="line">		&#123;</div><div class="line">			if (raw[j] &gt; raw[j + 1])</div><div class="line">			&#123;</div><div class="line">				temp = raw[j];</div><div class="line">				raw[j] = raw[j + 1];</div><div class="line">				raw[j + 1] = temp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這個我想對於任何稍微懂一點點template的人來說，都不困難，而這個使用也不需要額外的引數參考，可以直接套進去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">std::vector&lt;int&gt; array = &#123;15, 22, 11, 13, 72, 19&#125;;</div><div class="line">sort(array); //不用寫成sort&lt;int&gt;(array);</div></pre></td></tr></table></figure>
<p>接下來就是刺激的部分了。我們需要一個Camparer來加入戰場，我們可以很輕易地寫出來他的簽名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">template&lt;typename T&gt;</div><div class="line">void sort(std::vector&lt;T&gt;&amp; raw, std::function&lt;bool(T&amp;, T&amp;)&gt; comparer);</div></pre></td></tr></table></figure>
<p>這邊乍看之下是沒太大問題，但是當使用的時候問題就來了：我們需要一個default的comparer，這個comparer只需要<code>return A &gt; B;</code>即可。要是A, B所屬的class沒有定義operator&gt;(), 反正錯誤訊息會提示你說他們無從比對。ok, 所以看起來我們只要按照C++11的做法做一個default lambda來當作預設參數…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">template&lt;typename T&gt;</div><div class="line">auto defComparer = [](T&amp; A, T&amp;B)-&gt;bool&#123; return A &gt; B; &#125;;</div><div class="line"></div><div class="line">/*</div><div class="line">其實他真正的型別應該是長這樣，只是我們通常用C++11 auto呼籠過去省得麻煩而已 : </div><div class="line">template&lt;typename T&gt;</div><div class="line">std::function&lt;bool(T&amp;, T&amp;)&gt; defaultComparer = [](T&amp; a, T&amp; b)-&gt;bool&#123; return a &gt; b; &#125;;</div><div class="line">*/</div><div class="line"></div><div class="line">template&lt;typename T&gt;</div><div class="line">void sort(std::vector&lt;T&gt;&amp; raw, std::function&lt;bool(T&amp;, T&amp;)&gt; comparer = defaultComparer);</div></pre></td></tr></table></figure>
<p>鐺鐺，編譯器發出了警告，把這行code擋了下來：對不起，lambda不能為template，阿哈哈哈你看看你!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sort_example.cpp:6:29: error: variable &apos;defaultComparer&apos; declared as a template</div><div class="line">std::function&lt;bool(T&amp;, T&amp;)&gt; defaultComparer = [](T&amp; a, T&amp; b)-&gt;bool&#123; return a &gt; b; &#125;;</div><div class="line">                            ^</div></pre></td></tr></table></figure></p>
<p>在C++11中，Lambda的實作是無法template化的。也許我們會想到利用<a href="http://blog.monkeypotion.net/gameprog/beginner/exploring-the-field-of-policy-based-class-design" target="_blank" rel="external">Policy</a>來實作這種情況，可是很不幸的是… function就是function你去哪生個繼承出來？</p>
<p>比較普遍的做法是，使用overload來解決這個問題，所以code看起來會像是這樣 : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;vector&gt;</div><div class="line"></div><div class="line">template&lt;typename T&gt;</div><div class="line">bool defaultComparer(const T&amp; a, const T&amp; b) &#123;</div><div class="line">	return a &gt; b;</div><div class="line">&#125;</div><div class="line"></div><div class="line">template&lt;typename T&gt;</div><div class="line">void sort(std::vector&lt;T&gt;&amp; raw) &#123;</div><div class="line">	int n = raw.size();</div><div class="line">	T temp;</div><div class="line">	for (int i = n - 1; i &gt; 0; i--)</div><div class="line">	&#123;</div><div class="line">		for (int j = 0; j &lt;= i - 1; j++)</div><div class="line">		&#123;</div><div class="line">			if (raw[j] &gt; raw[j + 1])</div><div class="line">			&#123;</div><div class="line">				temp = raw[j];</div><div class="line">				raw[j] = raw[j + 1];</div><div class="line">				raw[j + 1] = temp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">template&lt;typename T&gt;</div><div class="line">void sort(std::vector&lt;T&gt;&amp; raw, std::function&lt;bool(const T&amp;, const T&amp;)&gt; comparer) &#123;</div><div class="line">	int n = raw.size();</div><div class="line">		T temp;</div><div class="line">		for (int i = n - 1; i &gt; 0; i--)</div><div class="line">		&#123;</div><div class="line">			for (int j = 0; j &lt;= i - 1; j++)</div><div class="line">			&#123;</div><div class="line">				if (comparer(raw[j], raw[j + 1]))</div><div class="line">				&#123;</div><div class="line">					temp = raw[j];</div><div class="line">					raw[j] = raw[j + 1];</div><div class="line">					raw[j + 1] = temp;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class TestObject &#123;</div><div class="line">	int a;</div><div class="line">	int b;</div><div class="line">	public:</div><div class="line">	TestObject(int a, int b) : a(a), b(b)&#123;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	TestObject() = default;</div><div class="line">	bool operator&gt;(const TestObject&amp; obj) const &#123;</div><div class="line">		return this-&gt;getValue() &gt; obj.getValue();</div><div class="line">	&#125;</div><div class="line">	int getValue() const &#123;</div><div class="line">		return a * b;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">int main(int argc, char *argv[]) &#123;</div><div class="line">	//requires C++11</div><div class="line">	std::vector&lt;int&gt; array1 = &#123;15, 22, 11, 13, 72, 19&#125;;</div><div class="line">	//吃沒有comparer的sort, 注意這個sort不需要sort&lt;int&gt; 而且int, double float等等都吃</div><div class="line">	//只要系統有定義&gt;的都吃</div><div class="line">	sort(array1);</div><div class="line">	</div><div class="line">	for(int i : array1)</div><div class="line">		std::cout &lt;&lt; i &lt;&lt; &quot; &quot;;</div><div class="line">	</div><div class="line">	std::cout &lt;&lt; std::endl;</div><div class="line">	</div><div class="line"></div><div class="line">			</div><div class="line">	std::vector&lt;TestObject&gt; array2 = &#123;TestObject(1, 4), TestObject(2, 3), TestObject(0, 4), TestObject(3, 3), TestObject(9, 1)&#125;;</div><div class="line">	</div><div class="line">	//印出排序前的Array2</div><div class="line">	for(TestObject a : array2) </div><div class="line">		std::cout &lt;&lt; a.getValue() &lt;&lt; &quot; &quot;;</div><div class="line">	std::cout &lt;&lt; std::endl;</div><div class="line">	</div><div class="line">	//使用有comparer的sort，注意這得指定型別，不過可以試試看她吃不吃沒comparer的預設版本 XD</div><div class="line">	sort&lt;TestObject&gt;(array2, [](const TestObject&amp; a, const TestObject&amp; b)-&gt;bool&#123; return a.getValue() &gt; b.getValue();&#125;);</div><div class="line">	//印出排序後的Array2</div><div class="line">	for(TestObject a : array2) </div><div class="line">		std::cout &lt;&lt; a.getValue() &lt;&lt; &quot; &quot;;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這算一種過渡性的做法吧，哎 :3 (本文仍然會繼續修改）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/20/talking-about-the-c-11-lambda-3/" data-id="cj3b76voh000ehzsivbljenzb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-let-your-stdvectoror-something-else-compatible-with-stream-operator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/20/let-your-stdvectoror-something-else-compatible-with-stream-operator/" class="article-date">
  <time datetime="2014-01-19T23:55:00.000Z" itemprop="datePublished">2014-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/20/let-your-stdvectoror-something-else-compatible-with-stream-operator/">Let your std::vector(or something else) compatible with stream operator &lt;&lt;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Not a quite secret, just have some operator overload trick.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; target, <span class="keyword">const</span> <span class="keyword">char</span>* word) &#123;</div><div class="line">	target.insert(target.end(), word, word + <span class="built_in">std</span>::<span class="built_in">strlen</span>(word));</div><div class="line">	<span class="keyword">return</span> target;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; target, <span class="keyword">char</span> word) &#123;</div><div class="line">	target.push_back(word);</div><div class="line">	<span class="keyword">return</span> target;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; target, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; word) &#123;</div><div class="line">	<span class="keyword">return</span> (target &lt;&lt; word.c_str());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This method have several benefit, first, <code>std::vector</code> can be inserted in templated class, to replace any stream : </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ContinerType&gt;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomethingFooFooFoo</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">somethingBalabala</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; source)</span> </span>&#123;</div><div class="line">  	ContainerType container;</div><div class="line">    container &lt;&lt; source;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//it works</span></div><div class="line"><span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">aString</span><span class="params">(<span class="string">"I am a string"</span>)</span></span>;</div><div class="line"></div><div class="line">SomethingFooFooFoo&lt;<span class="built_in">std</span>::iostream&gt; something;</div><div class="line">something.somethingBalabala(aString); <span class="comment">//Works</span></div><div class="line"></div><div class="line">SomethingFooFooFoo&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&gt; somethingElse;</div><div class="line">somethingElse.somethingBalabala(aString); <span class="comment">//also works</span></div></pre></td></tr></table></figure>
<p>It can load up data into container, with controlled type. If you wish, you can even load any byte data into it(using first two implementations). Unloading a vector is quite easy, just use </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">const signed char* dumpData = (const signed char*)vectorContainer.data();</div></pre></td></tr></table></figure>
<p>It’s easy, but there is 2 important highlight and ignoring these will easily mess up your code:</p>
<ol>
<li>This data have the same life cycle with the vector container, if the vector is destoryed, this data will no longer valid.</li>
<li>This data should use <code>const</code> to get the data! missing <code>const</code> will directly changes data in vector, and cause unexpected side effect, be advised!</li>
</ol>
<p>For sake of safely, you should get this data via memcpy, or you know what you are doing. in general case, put both <code>dumpData</code> and <code>vectorContainer</code> in the same scope is a good idea, and it is common sense that you should not pass dumpData with pointer to outside of the scope.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/20/let-your-stdvectoror-something-else-compatible-with-stream-operator/" data-id="cj3b76vod000bhzsi6r5t91tg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-talking-about-the-c-11-lambda-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/20/talking-about-the-c-11-lambda-2/" class="article-date">
  <time datetime="2014-01-19T19:20:00.000Z" itemprop="datePublished">2014-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/20/talking-about-the-c-11-lambda-2/">淺談C++11 Lambda (2)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>(這是一個placeholder 主要是講述C++11 lambda的語法)<br>(這篇還沒寫，但是3已經寫好了 所以…..囧)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/20/talking-about-the-c-11-lambda-2/" data-id="cj3b76vof000chzsinfss5g3h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-talking-about-the-c-11-lambda" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/17/talking-about-the-c-11-lambda/" class="article-date">
  <time datetime="2014-01-16T22:39:00.000Z" itemprop="datePublished">2014-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/17/talking-about-the-c-11-lambda/">淺談C++11 Lambda (1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#披荊斬棘的史前時代</p>
<p>Lambda在很多語言中有著相當的地位，不過相似的工具一直在C++11以前都付之闋如，而必須用傳入函數指標的方式來達成類似的效果 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//這種寫法我們稱為C-Stype</div><div class="line">typedef int(*compare)(void*, void*);</div><div class="line">void sort(void** sortingObjects, int length, compare comparer);</div></pre></td></tr></table></figure></p>
<p>這種寫法其實剛好踩在清楚不清楚的邊緣，而且說真的這種void*亂轉看起來也不太靠譜，所以後來大家在C++就改成用template來完成類似的東西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//這個其實是編譯不過去的....</div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">int compare(const CmpObj&amp; Obj1, const CmpObj&amp; Obj2);</div><div class="line"></div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">void sort(const CmpObj* objList, int length, compare&lt;CmpObj&gt; comparer);</div></pre></td></tr></table></figure>
<p>但是typedef其實這舊時代產物是不吃template的（這原因頗長，不過可以想想其實typedef原始目的根本不是拿來定義跟簡化函數指標），所以要不就是用C++11的using關鍵字，要不就是用很類似java的workaround</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//C++11 only</div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">using compare = int (*) (const CmpObj&amp; obj1, const CmpObj&amp; obj2); </div><div class="line"></div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">void sort(const CmpObj* objList, int length, compare&lt;CmpObj&gt; comparer);</div><div class="line"></div><div class="line">//如果想要長得像Java的話...</div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">struct ComparerStr &#123;</div><div class="line">	//這static很重要 少了它就沒辦法ComparerStr&lt;CmpObj&gt;::compare了</div><div class="line">  //當然你要new一個我也不反對，只是這種東西多半是static，不管是new一個還是丟實體進去意義都差不多</div><div class="line">  //new的話還額外多了一個delete的成本跟風險。</div><div class="line">	static int compare(const CmpObj&amp; obj1, const CmpObj&amp; obj2);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">//裡面就可以直接取cmp::compare,我就不多寫實做怎麼做了</div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">void sort(const CmpObj* objList, int length, ComparerStr&lt;CmpObj&gt; cmp);</div></pre></td></tr></table></figure>
<p>在還沒有C++11 using的年頭，很顯然的要不就是學這種類java的做法丟class進去，要不就是用很恐怖的函數指標方式來處理這種問題。除了C Programmer以外，我想應該不會有太多正常人喜歡用函數指標，於是大家就開始使用boost::function以及旗下一大套東西來「表達」一個function</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boost::function&lt;int(void*, void*)&gt; comparer;</div></pre></td></tr></table></figure>
<p>但是很不幸的是，雖然C++提供template的技術，卻沒辦法讓你產生一個「template化的template」，所以事實上boost的做法並沒有辦法讓你提供comparer用的型別。</p>
<p>上面的做法其實都有兩個很類似的問題，其中後者是相依于前者的，也就是：</p>
<ul>
<li>我必須把一個僅僅使用一次的comparer額外定義在一個很遙遠的地方，然後才能引用他，而非「他被用到的地方」</li>
<li>要是這個comparer還需要根據一個外部變數來工作，那就死了</li>
</ul>
<p>#後來參戰的Obj-C<br>然後Obj-C開始有類似的技術 叫做Block<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//由於id可以吃任何東西，以及由於obj-c語言特性，這個其實連template都用不上</div><div class="line">typedef int* (^comparer_block)(id, id);</div><div class="line">-(void) sort:(NSArray*) objects andComparer:(comparer_block) comparer;</div></pre></td></tr></table></figure></p>
<p>這個我們就不深究了，畢竟這邊以C++ lambda為主。不過請記住， <strong>其實Obj-C的block就是Lambda</strong> </p>
<p>#C++11終於出現的Lambda</p>
<p>我們先拿一個簡單的東西作例子，就拿Bjarne Stroustrup自家的C++11 FAQ舉的例子吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//預設的sort法</div><div class="line">std::sort(v.begin(), v.end());</div><div class="line">//用我們自己決定的comparer來sort</div><div class="line">std::sort(v.begin(), v.end(), [](int a, int b) &#123; return abs(a)&lt;abs(b); &#125;);</div></pre></td></tr></table></figure>
<p>這邊定義了一個新的sort方法，用新的Comparer來定義Sort的順序，從以default改為絕對值。在我們搞清楚怎麼把lambda寫入函式簽名以前，我們先看看這語法上代表的什麼意義</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//-&gt;bool是可以省略的，這個相當於指定回傳型別</div><div class="line">[](int a, int b)-&gt;bool &#123; return abs(a) &lt; abs(b);&#125;</div></pre></td></tr></table></figure>
<p>這邊一共分三個部分，[]等等會提到是什麼意思，而且在這例子裡面其實並沒有用到。中間則是很明顯的他需要兩個參數，都是int，而且是pass by value，最後則是隱式的傳回bool，沒有在裡面宣告。</p>
<p>接下來的問題就是，如果我們要求一個特定簽名的lambda，那這個要怎麼寫？以前的函數指標可能可以寫成這樣<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">typedef int(*CMP)(void*, void*);</div><div class="line">//然後我們可以要求下面兩種之一的寫法</div><div class="line">void sort(void* itemArray, int length, int(*CMP)(void*, void*));</div><div class="line">void sort(void* itemArray, int length, CMP cmp);</div></pre></td></tr></table></figure></p>
<p>在C++11要使用Lambda的場合則是用C++11新的std::function來當作參數來傳遞。另外，雖然上面提到的code很多明明有用到C++11卻可以再沒有–std=c++11的flag下編譯過關， <strong><em>可是下面這組code沒–std=c++11會死，請把它加入g++的參數裡面</em></strong> 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//這也沒有真正的sort 說說而已 XD</div><div class="line">template&lt;typename CmpObj&gt;</div><div class="line">void sort(std::vector&lt;CmpObj&gt; objList, std::function&lt;int(CmpObj&amp;, CmpObj&amp;)&gt; func) &#123;</div><div class="line">	CmpObj a, b;</div><div class="line">	a = objList[0];</div><div class="line">	b = objList[1];</div><div class="line">	printf(&quot;return : %d&quot;, func(a, b));</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char *argv[]) &#123;</div><div class="line">	int a = 1;</div><div class="line">	int b = 2;</div><div class="line">	std::vector&lt;int&gt; list;</div><div class="line">	list.push_back(a);</div><div class="line">	list.push_back(b);</div><div class="line">  //這個&lt;int&gt;恐怕免不了，g++似乎無法正確推導lambda裡面的template parameter</div><div class="line">	sort&lt;int&gt;(list, [](int x, int y)&#123; printf(&quot;%d, %d\n&quot;, x, y); return 1;&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OK，這邊先淺嚐即止，剩下的我們留到下一篇討論。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/17/talking-about-the-c-11-lambda/" data-id="cj3b76vob000ahzsi3qkydbqk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-no-modern-design-modern-c" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/15/no-modern-design-modern-c/" class="article-date">
  <time datetime="2014-01-14T23:42:00.000Z" itemprop="datePublished">2014-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/01/15/no-modern-design-modern-c/">不再Modern的Modern C++ Design... :)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>寫在前面，我沒有任何貶低這本書的意思。這本書畢竟已經十幾年了，但是仍然是在C++技術領域中的經典之作。不過，在C++11出現的現在，這本在一些地方顯然是有點過時，所以每當我發現裡面有一些目前C++11已經可以cover掉的tech，我會在這裡做些補充。</p>
<p>##STATIC_CHECK (replaced by C++11 static_assert() )<br>會發現這個其實是有點意外，因為這東西其實不太容易發現。我們先看看Loki版本的STATIC_CHECK長什麼樣子<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STATIC_CHECK(expr) &#123; char unnamed[(expr) ? 1 : 0]; &#125;</span></div></pre></td></tr></table></figure></p>
<p>這個容許你能夠在編譯期檢查一些東西。這東西建立在一個前提下：char[1]是可以合法編譯過關，而char[0]則會造成編譯錯誤，所以他有能力在compile time檢查硬生生的把compiling過程擋下來。以Modern C++ Design自己舉的例子來講<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TO, <span class="keyword">typename</span> FROM&gt;</div><div class="line"><span class="function">TO <span class="title">safe_reinterpret_cast</span><span class="params">(FROM from)</span> </span>&#123;</div><div class="line">        STATIC_CHECK(<span class="keyword">sizeof</span>(TO) &gt;= <span class="keyword">sizeof</span>(FROM));</div><div class="line">        <span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;TO&gt;(from);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>這個template其實極其簡單，就是如果你試圖把FROM轉成TO，他會先檢查TO是否是個足夠大，至少要足以容納FROM的大小，簡單的說，假設你的TO是char，FROM是double，他就會invoke出STATIC_CHECK，讓STATIC_CHECK編譯錯誤，因為試圖做一個char array大小為0。</p>
<p>不過這段Code因為規格變更，有 <strong>很多</strong> 地方不再正確，我們一個個的看一下。</p>
<p>首先，你會發現char[0]其實已經在C99合法化了，至於[0]的用途請參照<a href="http://gcc.gnu.org/onlinedocs/gcc/Zero-Length.html" target="_blank" rel="external">這裡</a>，所以char[0]不再會造成編譯錯誤。另外，reinterpret_cast在C++11下已經會做出大小的檢查，已經不再允許把大的資料結構硬轉成小的資料結構了。</p>
<p>最後一點，也是最重要的是，C++11引入了<code>static_assert(bool willAssert, const char* assertMessage)</code>，使得這種做法不再必要。不過，我們有很多舊有的code，該怎麼辦呢？</p>
<p>在不支援C++11(但是因為C99所以可以合法宣告0長度array的場合)<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//既然0不會報錯，-1總會死了吧？</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STATIC_CHECK(expr) &#123; char unnamed[(expr) ? 1 : -1]; &#125;</span></div></pre></td></tr></table></figure></p>
<p>支援C++11的場合<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STATIC_CHECK(expr) &#123; static_assert(expr, <span class="meta-string">"Static Assert is invoked!"</span>); &#125;</span></div></pre></td></tr></table></figure></p>
<p>當然，新的code請都用static_assert來取代STATIC_CHECK</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/01/15/no-modern-design-modern-c/" data-id="cj3b76vo60008hzsi8w93dos0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/04/09/how-to-use-cmake-with-git-to-easily-use-external-library/">如何利用CMake跟git來輕易的使用外部Library</a>
          </li>
        
          <li>
            <a href="/2017/02/13/python-trick-burst-attack-test/">Python Trick : Burst Attack Test</a>
          </li>
        
          <li>
            <a href="/2016/02/03/most-vexing-parsingc/">Most Vexing Parsing(C++)</a>
          </li>
        
          <li>
            <a href="/2015/08/23/markdown-text-color-support/">Markdown文字色彩支援</a>
          </li>
        
          <li>
            <a href="/2015/08/16/starry-sky/">Starry Sky</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>